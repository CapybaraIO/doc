"use strict";(self.webpackChunk_hirosystems_docs=self.webpackChunk_hirosystems_docs||[]).push([[9151],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>k});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=l(a),m=i,k=u["".concat(c,".").concat(m)]||u[m]||h[m]||r;return a?n.createElement(k,s(s({ref:t},p),{},{components:a})):n.createElement(k,s({ref:t},p))}));function k(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[u]="string"==typeof e?e:i,s[1]=o;for(var l=2;l<r;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},43426:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var n=a(87462),i=(a(67294),a(3905));const r={Title:"Overview"},s="Stacks Blockchain API Overview",o={unversionedId:"stacks-blockchain-api/index",id:"stacks-blockchain-api/index",title:"Stacks Blockchain API Overview",description:"The Stacks blockchain API allows you to query the Stacks blockchain and interact with smart contracts. It was built to maintain paginated, materialized views of the Stacks Blockchain.",source:"@site/docs/stacks-blockchain-api/index.md",sourceDirName:"stacks-blockchain-api",slug:"/stacks-blockchain-api/",permalink:"/doc/stacks-blockchain-api/",draft:!1,editUrl:"https://github.com/CapybaraIO/doc/tree/main/docs/stacks-blockchain-api/index.md",tags:[],version:"current",lastUpdatedAt:1703206175,formattedLastUpdatedAt:"Dec 22, 2023",frontMatter:{Title:"Overview"},sidebar:"stacks-api",next:{title:"Getting Started",permalink:"/doc/stacks-blockchain-api/getting-started"}},c={},l=[{value:"Architecture",id:"architecture",level:2},{value:"OpenAPI Spec",id:"openapi-spec",level:2},{value:"TypeScript client library",id:"typescript-client-library",level:3},{value:"HTTP API client sample",id:"http-api-client-sample",level:3},{value:"TypeScript sample",id:"typescript-sample",level:3},{value:"WebSocket sample",id:"websocket-sample",level:3}],p={toc:l},u="wrapper";function h(e){let{components:t,...r}=e;return(0,i.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"stacks-blockchain-api-overview"},"Stacks Blockchain API Overview"),(0,i.kt)("p",null,"The Stacks blockchain API allows you to query the Stacks blockchain and interact with smart contracts. It was built to maintain paginated, materialized views of the Stacks Blockchain."),(0,i.kt)("p",null,"The Stacks Blockchain API is hosted by Hiro. Using it requires you to trust us as the hosted server, but in return we provide a faster development experience. If you want a fully trustless architecture for your app, you may wish to consider running your own API instance."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"NOTE:"))),(0,i.kt)("p",{parentName:"blockquote"},"To explore the detailed documentation for the API endpoints, request and response formats, you can refer to the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.hiro.so/api"},"API Reference"),"."),(0,i.kt)("p",{parentName:"blockquote"},"The source code for this project is available in our ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/stacks-blockchain-api"},"GitHub repository"),". You can explore the codebase, ",(0,i.kt)("a",{parentName:"p",href:"https://docs.hiro.so/contributors-guide"},"contribute"),", and raise ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/stacks-blockchain-api/issues"},"issues")," or ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/stacks-blockchain-api/pulls"},"pull requests"),".")),(0,i.kt)("h2",{id:"architecture"},"Architecture"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"API architecture!",src:a(66363).Z,width:"2931",height:"1571"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks-node")," has its own minimal set of http endpoints referred to as ",(0,i.kt)("inlineCode",{parentName:"p"},"RPC endpoints")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"stacks-blockchain-api")," allows clients to access these endpoints by proxying them through to a load-balanced pool of ",(0,i.kt)("inlineCode",{parentName:"li"},"stacks-nodes"),"."),(0,i.kt)("li",{parentName:"ul"},"See: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/blockstack/stacks-blockchain/blob/master/docs/rpc-endpoints.md"},"https://github.com/blockstack/stacks-blockchain/blob/master/docs/rpc-endpoints.md")," -- some common ones:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"POST /v2/transactions")," - broadcast a transaction."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GET /v2/pox")," - get current PoX-relevant information."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"POST /v2/contracts/call-read/<contract>/<function>")," - evaluate and return the result of calling a Clarity function."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"POST /v2/fees/transaction")," - evaluate a given transaction and return transaction fee estimation data."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GET /v2/accounts/<address>")," - get the current ",(0,i.kt)("inlineCode",{parentName:"li"},"nonce")," required for creating transactions."))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The endpoints implemented by ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks-blockchain-api")," provide data that the ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks-node")," can't due to various constraints."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Typically this is either data that the ",(0,i.kt)("inlineCode",{parentName:"li"},"stacks-node")," doesn't persist, or data that it cannot efficiently serve to many clients.\nFor example, the ",(0,i.kt)("inlineCode",{parentName:"li"},"stacks-node")," can return the current STX balance of an account, but it can't return a history of account transactions."),(0,i.kt)("li",{parentName:"ul"},'The API also implements the Rosetta spec created by Coinbase -- "an open standard designed to simplify blockchain deployment and interaction."',(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"See: ",(0,i.kt)("a",{parentName:"li",href:"https://www.rosetta-api.org/"},"https://www.rosetta-api.org/")))),(0,i.kt)("li",{parentName:"ul"},"The API also implements the BNS (Blockchain Naming System) endpoints.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"See ",(0,i.kt)("a",{parentName:"li",href:"https://docs.stacks.co/build-apps/references/bns"},"https://docs.stacks.co/build-apps/references/bns")))),(0,i.kt)("li",{parentName:"ul"},"See ",(0,i.kt)("inlineCode",{parentName:"li"},"/src/api/routes")," for the Express.js routes."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'The API creates an "event observer" http server which listens for events from a ',(0,i.kt)("inlineCode",{parentName:"p"},"stacks-node"),' "event emitter"'),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"These events are http POST requests that contain things like blocks, transactions, byproducts of executed transactions.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'Transaction "byproducts" are things like asset transfers, smart-contract log data, execution cost data.'))),(0,i.kt)("li",{parentName:"ul"},"The API processes and stores these as relational data in postgres."),(0,i.kt)("li",{parentName:"ul"},"See ",(0,i.kt)("inlineCode",{parentName:"li"},"/src/event-stream"),' for the "event observer" code.'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"All http endpoints and responses are defined in OpenAPI and JSON Schema."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"See ",(0,i.kt)("inlineCode",{parentName:"li"},"/docs/openapi.yaml")),(0,i.kt)("li",{parentName:"ul"},"These are used to auto generate the docs at ",(0,i.kt)("a",{parentName:"li",href:"https://hirosystems.github.io/stacks-blockchain-api/"},"https://hirosystems.github.io/stacks-blockchain-api/")),(0,i.kt)("li",{parentName:"ul"},"The JSON Schemas are converted into Typescript interfaces, which are used internally by the db controller module to transform SQL query results into the correct object shapes."),(0,i.kt)("li",{parentName:"ul"},"ALSO the OpenAPI + JSONSchemas are used to generate a standalone ",(0,i.kt)("inlineCode",{parentName:"li"},"@stacks/blockchain-api-client"),"."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The easiest/quickest way to develop in this repo is using the VS Code debugger. It uses docker-compose to setup a ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks-node")," and Postgres instance."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Alternatively, you can run ",(0,i.kt)("inlineCode",{parentName:"li"},"npm run dev:integrated")," which does the same thing but without a debugger.")))),(0,i.kt)("h2",{id:"openapi-spec"},"OpenAPI Spec"),(0,i.kt)("p",null,"The Stacks API was designed using the ",(0,i.kt)("a",{parentName:"p",href:"https://swagger.io/specification/"},"OpenAPI specification"),", making it compatible with a variety of developer tools."),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/stacks-blockchain-api/blob/master/docs/openapi.yaml"},"OpenAPI specification file for Stacks")," is used to generate the TypeScript client library. You can use the specification file to generate client libraries for other programming languages using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/OpenAPITools/openapi-generator"},"openapi-generator tool")),(0,i.kt)("h3",{id:"typescript-client-library"},"TypeScript client library"),(0,i.kt)("p",null,"A Typescript client library is available for use of the Stacks API. The client library enables type-safe REST and WebSocket communication with the Stacks API endpoints."),(0,i.kt)("p",null,"The client is made up of three components:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Generated HTTP API client"),(0,i.kt)("li",{parentName:"ol"},"Typescript definitions for ",(0,i.kt)("a",{parentName:"li",href:"https://docs.hiro.so/stacks-blockchain-api/feature-guides/use-clarity-values"},"Clarity values")),(0,i.kt)("li",{parentName:"ol"},"WebSocket client")),(0,i.kt)("p",null,"The following sections demonstrate common usages of the TypeScript API client."),(0,i.kt)("h3",{id:"http-api-client-sample"},"HTTP API client sample"),(0,i.kt)("p",null,"The Typescript client library requires you to specify the underlying HTTP request library to handle HTTP communication. The example below uses the universal fetch API ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lquixada/cross-fetch"},(0,i.kt)("inlineCode",{parentName:"a"},"cross-fetch")),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import fetch from 'cross-fetch';\nimport { Configuration, AccountsApi } from '@stacks/blockchain-api-client';\n(async () => {\n  const apiConfig = new Configuration({\n    fetchApi: fetch,\n    // for mainnet, replace `testnet` with `mainnet`\n    basePath: 'https://api.testnet.hiro.so', // defaults to http://localhost:3999\n  });\n  // initiate the /accounts API with the basepath and fetch library\n  const accountsApi = new AccountsApi(apiConfig);\n  // get transactions for a specific account\n  const txs = await accountsApi.getAccountTransactions({\n    principal: 'ST000000000000000000002AMW42H',\n  });\n  console.log(txs);\n})().catch(console.error);\n")),(0,i.kt)("h3",{id:"typescript-sample"},"TypeScript sample"),(0,i.kt)("p",null,"The following sample shows how generated ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/stacks-blockchain-api/tree/master/client/src/generated/models"},"TypeScript models")," can be used for type-safety:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import fetch from 'cross-fetch';\nimport {\n  Configuration,\n  AccountsApi,\n  AccountsApiInterface,\n  AddressBalanceResponse,\n  AddressBalanceResponseStx,\n} from '@stacks/blockchain-api-client';\n(async () => {\n  const apiConfig: Configuration = new Configuration({\n    fetchApi: fetch,\n    // for mainnet, replace `testnet` with `mainnet`\n    basePath: 'https://api.testnet.hiro.so', // defaults to http://localhost:3999\n  });\n  const principal: string = 'ST000000000000000000002AMW42H';\n  // initiate the /accounts API with the basepath and fetch library\n  const accountsApi: AccountsApiInterface = new AccountsApi(apiConfig);\n  // get balance for a specific account\n  const balance: AddressBalanceResponse = await accountsApi.getAccountBalance({\n    principal,\n  });\n  // get STX balance details\n  const stxAmount: AddressBalanceResponseStx = balance.stx;\n  console.log(stxAmount);\n})().catch(console.error);\n")),(0,i.kt)("h3",{id:"websocket-sample"},"WebSocket sample"),(0,i.kt)("p",null,"The WebSocket components enable you to subscribe to specific updates, providing a near real-time display of updates on transactions and accounts."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import { connectWebSocketClient } from '@stacks/blockchain-api-client';\nconst client = await connectWebSocketClient('ws://stacks-node-api.blockstack.org/');\nconst sub = await client.subscribeAddressTransactions(contractCall.txId, event => {\n  console.log(event);\n});\nawait sub.unsubscribe();\n")))}h.isMDXComponent=!0},66363:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/api-architecture-1c946a0a355b65f7dd122aec4c0d5ac1.png"}}]);