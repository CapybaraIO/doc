"use strict";(self.webpackChunk_hirosystems_docs=self.webpackChunk_hirosystems_docs||[]).push([[9070],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=l(a),h=r,m=d["".concat(p,".").concat(h)]||d[h]||u[h]||s;return a?n.createElement(m,o(o({ref:t},c),{},{components:a})):n.createElement(m,o({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,o=new Array(s);o[0]=h;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[d]="string"==typeof e?e:r,o[1]=i;for(var l=2;l<s;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},53256:(e,t,a)=>{a.d(t,{ZP:()=>i});var n=a(87462),r=(a(67294),a(3905));const s={toc:[]},o="wrapper";function i(e){let{components:t,...a}=e;return(0,r.kt)(o,(0,n.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("a",{class:"block p-4 text-neutral-800 dark:text-neutral-100 hover:bg-neutral-100 hover:dark:bg-neutral-600 bg-neutral-200 rounded-lg dark:bg-neutral-700 mb-6 hover:no-underline hover:text-neutral-800 hover:dark:text-neutral-100 transition-colors",href:"https://docs.hiro.so/stacksjs-starters"},(0,r.kt)("span",{class:"i-radix-icons-lightning-bolt align-text-bottom text-lg"})," Bootstrap your project with ",(0,r.kt)("strong",null,"Stacks.js Starters"),", which come with Stacks Connect pre-installed ",(0,r.kt)("span",{class:"i-bi-globe2 align-text-bottom text-lg"})))}i.isMDXComponent=!0},41157:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>p,toc:()=>c});var n=a(87462),r=(a(67294),a(3905)),s=a(53256);const o={title:"Store Data Securely"},i=void 0,p={unversionedId:"stacks.js/guides/store-data-securely",id:"stacks.js/guides/store-data-securely",title:"Store Data Securely",description:"This guide explains how to save and retrieve data for users with Gaia by implementing the connect and storage packages of Stacks.js.",source:"@site/docs/stacks.js/guides/store-data-securely.md",sourceDirName:"stacks.js/guides",slug:"/stacks.js/guides/store-data-securely",permalink:"/doc/stacks.js/guides/store-data-securely",draft:!1,editUrl:"https://github.com/CapybaraIO/doc/tree/main/docs/stacks.js/guides/store-data-securely.md",tags:[],version:"current",frontMatter:{title:"Store Data Securely"}},l={},c=[{value:"Install dependencies",id:"install-dependencies",level:2},{value:"Initiate session",id:"initiate-session",level:2},{value:"Save data for session user",id:"save-data-for-session-user",level:2},{value:"Get data for session user",id:"get-data-for-session-user",level:2},{value:"Get data for other user",id:"get-data-for-other-user",level:2},{value:"Delete data for session user",id:"delete-data-for-session-user",level:2}],d={toc:c},u="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(s.ZP,{mdxType:"StacksjsStartersNote"}),(0,r.kt)("p",null,"This guide explains how to save and retrieve data for users with ",(0,r.kt)("a",{parentName:"p",href:"https://docs.stacks.co/build-apps/references/gaia"},"Gaia")," by implementing the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hirosystems/connect/"},(0,r.kt)("inlineCode",{parentName:"a"},"connect"))," and ",(0,r.kt)("a",{parentName:"p",href:"https://stacks.js.org/modules/storage.html"},(0,r.kt)("inlineCode",{parentName:"a"},"storage"))," packages of Stacks.js."),(0,r.kt)("p",null,"Data storage provides a way for users to save both public and private data off-chain while retaining complete control over it."),(0,r.kt)("p",null,"Storing data off the Stacks blockchain ensures that apps can provide users with high performance and high availability for data reads and writes without the involvement of centralized parties that could compromise their privacy or accessibility."),(0,r.kt)("p",null,"See the To-dos app tutorial for a concrete example of this feature in practice."),(0,r.kt)("h2",{id:"install-dependencies"},"Install dependencies"),(0,r.kt)("p",null,"The following dependencies must be installed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm install @stacks/connect @stacks/storage\n")),(0,r.kt)("h2",{id:"initiate-session"},"Initiate session"),(0,r.kt)("p",null,"Users must authenticate to an app before the ",(0,r.kt)("inlineCode",{parentName:"p"},"storage")," package will work to save or retrieve data on their behalf."),(0,r.kt)("p",null,"See the authentication guide before proceeding to integrate the following data storage capabilities in cases where ",(0,r.kt)("inlineCode",{parentName:"p"},"userSession.isUserSignedIn()")," returns ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("h2",{id:"save-data-for-session-user"},"Save data for session user"),(0,r.kt)("p",null,"Gaia serves as a key-value store in which data is saved and retrieved as files to and from Gaia hubs owned by, or managed for, users."),(0,r.kt)("p",null,"The default Gaia hub for users who authenticate to apps with ",(0,r.kt)("a",{parentName:"p",href:"https://www.hiro.so/wallet/install-web"},"the Stacks Wallet")," is run by Hiro PBC at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://gaia.blockstack.org/"),". It supports files up to 25 megabytes in size."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Hiro recommends breaking data instances greater than 25 MB into several files, saving them individually, and recomposing them on retrieval.")),(0,r.kt)("p",null,"These files can comprise any type of data such as text, image, video or binary."),(0,r.kt)("p",null,"Files are often saved as strings that represent stringified JSON objects and contain a variety of properties for a particular model."),(0,r.kt)("p",null,"To save a file, first instantiate a ",(0,r.kt)("inlineCode",{parentName:"p"},"storage")," object using the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSession")," object for an authenticated user. Then proceed to call its ",(0,r.kt)("inlineCode",{parentName:"p"},"putFile")," method with relevant parameters:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { AppConfig, UserSession } from '@stacks/connect';\nimport { Storage } from '@stacks/storage';\n\nconst appConfig = new AppConfig(['store_write', 'publish_data']);\nconst userSession = new UserSession({ appConfig });\nconst storage = new Storage({ userSession });\n\nlet fileName = 'car.json';\n\nlet fileData = {\n  color: 'blue',\n  electric: true,\n  purchaseDate: '2019-04-03',\n};\n\nconst options = {\n  encrypt: true,\n};\n\nlet fileUrl = storage.putFile(fileName, JSON.stringify(fileData), options).then(() => {\n  // Handle any execution after data has been saved\n});\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter object contains an ",(0,r.kt)("inlineCode",{parentName:"p"},"encrypt")," property that when set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," indicates that the data should be encrypted with the user's app private key before saved to their Gaia hub. All data will be encrypted as such by default if the ",(0,r.kt)("inlineCode",{parentName:"p"},"encrypt")," property or the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," object itself is omitted entirely."),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"encrypt")," property is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),", the data will be saved completely unencrypted and available to everyone online with public access to the user's Gaia hub."),(0,r.kt)("p",null,"Whereas saving privately encrypted data is possible for all authenticated apps with the ",(0,r.kt)("a",{parentName:"p",href:"https://stacks.js.org/enums/auth.AuthScope.html#store_write"},(0,r.kt)("inlineCode",{parentName:"a"},"store_write"))," scope, the user must have previously granted the ",(0,r.kt)("a",{parentName:"p",href:"https://stacks.js.org/enums/auth.AuthScope.html#publish_data"},(0,r.kt)("inlineCode",{parentName:"a"},"publish_data"))," scope as well during authentication for the app to save publicly unencrypted data."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"putFile")," method returns the URL where the the file can be retrieved from the user's Gaia hub, as used here to set the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"fileUrl"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You'll need to save an entirely new string of modified data using ",(0,r.kt)("inlineCode",{parentName:"p"},"putFile")," with the same ",(0,r.kt)("inlineCode",{parentName:"p"},"fileName")," every time you want to update a record. There is no separate update method.")),(0,r.kt)("h2",{id:"get-data-for-session-user"},"Get data for session user"),(0,r.kt)("p",null,"To retrieve data previously saved for a user with an app, call the ",(0,r.kt)("inlineCode",{parentName:"p"},"getFile")," method available from the ",(0,r.kt)("inlineCode",{parentName:"p"},"storage")," object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { AppConfig, UserSession } from '@stacks/connect';\nimport { Storage } from '@stacks/storage';\n\nconst appConfig = new AppConfig(['store_write', 'publish_data']);\nconst userSession = new UserSession({ appConfig });\nconst storage = new Storage({ userSession });\n\nlet fileName = 'car.json';\n\nconst options = {\n  decrypt: true,\n};\n\nstorage.getFile(fileName, options).then(fileData => {\n  // Handle any execution that uses decrypted fileData\n});\n")),(0,r.kt)("p",null,"Note how the ",(0,r.kt)("inlineCode",{parentName:"p"},"decrypt")," property in the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," object here should implement the same boolean value as used for ",(0,r.kt)("inlineCode",{parentName:"p"},"encrypt")," initially upon saving the data with ",(0,r.kt)("inlineCode",{parentName:"p"},"putFile"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"decrypt")," property will default to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," if omitted."),(0,r.kt)("p",null,"Encrypted files need ",(0,r.kt)("inlineCode",{parentName:"p"},"decrypt")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," so the app knows to decrypt the data with the user's app private key before made available in the callback here as ",(0,r.kt)("inlineCode",{parentName:"p"},"fileData"),"."),(0,r.kt)("h2",{id:"get-data-for-other-user"},"Get data for other user"),(0,r.kt)("p",null,"Apps can also retrieve public data saved by users other than the one with the active session, granted those users have registered usernames via the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.stacks.co/build-apps/references/bns"},"Blockchain Naming System"),"."),(0,r.kt)("p",null,"Simply indicate the username of such a user in the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { AppConfig, UserSession } from '@stacks/connect';\nimport { Storage } from '@stacks/storage';\n\nconst appConfig = new AppConfig(['store_write', 'publish_data']);\nconst userSession = new UserSession({ appConfig });\nconst storage = new Storage({ userSession });\n\nlet fileName = 'car.json';\n\nconst options = {\n  username: 'markmhendrickson.id.blockstack',\n};\n\nstorage.getFile(fileName, options).then(fileData => {\n  // Handle any execution that uses decrypted fileData\n});\n")),(0,r.kt)("p",null,"This ",(0,r.kt)("inlineCode",{parentName:"p"},"getFile")," call will retrieve data found at the given ",(0,r.kt)("inlineCode",{parentName:"p"},"fileName")," path from the storage bucket of the Gaia hub that maps to the user who registered the given ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," and this particular app as hosted at the current domain."),(0,r.kt)("p",null,"Set an additional ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," property within ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," to retrieve data for a user as saved by an app hosted at a separate domain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const options = {\n  app: 'https://example.org',\n  username: 'markmhendrickson.id.blockstack',\n};\n")),(0,r.kt)("p",null,"This will cause the ",(0,r.kt)("inlineCode",{parentName:"p"},"getFile")," call to retrieve data found in a separate storage bucket for the indicated app on the user's Gaia hub."),(0,r.kt)("h2",{id:"delete-data-for-session-user"},"Delete data for session user"),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"deleteFile")," method on ",(0,r.kt)("inlineCode",{parentName:"p"},"storage")," to remove data found at a particular file path for the active session user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { AppConfig, UserSession } from '@stacks/connect';\nimport { Storage } from '@stacks/storage';\n\nconst appConfig = new AppConfig(['store_write', 'publish_data']);\nconst userSession = new UserSession({ appConfig });\nconst storage = new Storage({ userSession });\n\nlet fileName = 'car.json';\n\nstorage.deleteFile(fileName).then(() => {\n  // Handle any execution after file has been deleted\n});\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Apps can save and delete data only for the active session user.")))}h.isMDXComponent=!0}}]);