<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-token-metadata-api/feature-guides/token-metadata-api" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Token Metadata API | capybara</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://CapybaraIO.github.io/doc/token-metadata-api/feature-guides/token-metadata-api"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Token Metadata API | capybara"><meta data-rh="true" name="description" content="A microservice that indexes metadata for all Fungible, Non-Fungible, and Semi-Fungible Tokens in the Stacks blockchain and exposes it via JSON REST API endpoints."><meta data-rh="true" property="og:description" content="A microservice that indexes metadata for all Fungible, Non-Fungible, and Semi-Fungible Tokens in the Stacks blockchain and exposes it via JSON REST API endpoints."><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://CapybaraIO.github.io/doc/token-metadata-api/feature-guides/token-metadata-api"><link data-rh="true" rel="alternate" href="https://CapybaraIO.github.io/doc/token-metadata-api/feature-guides/token-metadata-api" hreflang="en"><link data-rh="true" rel="alternate" href="https://CapybaraIO.github.io/doc/token-metadata-api/feature-guides/token-metadata-api" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UL2NZRAK8K-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="capybara" href="/doc/opensearch.xml">

<link rel="preconnect" href="https://cdn.segment.io">
<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){if(window.analytics.initialized)return window.analytics[t].apply(window.analytics,arguments);var a=Array.prototype.slice.call(arguments);return a.unshift(t),e.push(a),e}};for(var t=0;t<e.methods.length;t++){var a=e.methods[t];e[a]=e.factory(a)}e.load=function(t,a){var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n),e._loadOptions=a},e._writeKey="qabJfWPhi2L9CeMk22A1XlYmabsNtgKy",e.SNIPPET_VERSION="4.16.1",e.load("qabJfWPhi2L9CeMk22A1XlYmabsNtgKy"),e.page()}}()</script>
<!-- Google Tag Manager -->
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-59XXGSG",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
<!-- End Google Tag Manager --><link rel="stylesheet" href="/doc/assets/css/styles.281c0b25.css">
<link rel="preload" href="/doc/assets/js/runtime~main.63eaacc7.js" as="script">
<link rel="preload" href="/doc/assets/js/main.873bcaee.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/doc/"><div class="navbar__logo"><img src="/doc/img/hiro-docs-logo.svg" alt="capybara" class="themedImage_ToTc themedImage--light_HNdA hiro-logo"><img src="/doc/img/hiro-docs-logo-dark.svg" alt="capybara" class="themedImage_ToTc themedImage--dark_i4oU hiro-logo"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link dropdown-nav">API References</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/ordinals">Ordinals API</a></li><li><a class="dropdown__link" href="/doc/api">Stacks Blockchain API</a></li><li><a class="dropdown__link" href="/doc/metadata">Token Metadata API</a></li></ul></div><a href="https://github.com/CapybaraIO/doc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub Repository" aria-label="GitHub Repository"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item back-link"><a class="menu__link" href="/doc/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item section-title">Token Metadata API</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/token-metadata-api">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/token-metadata-api/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item section-title">Features</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doc/token-metadata-api/feature-guides/token-metadata-api">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item section-title">Guides</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/token-metadata-api/how-to-guides/how-to-stop-service">Stop service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/token-metadata-api/how-to-guides/how-to-use-image-cache-service">Use Image Cache Service</a></li></ul></nav></div></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Token Metadata API</h1><p>A microservice that indexes metadata for all Fungible, Non-Fungible, and Semi-Fungible Tokens in the Stacks blockchain and exposes it via JSON REST API endpoints.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-architecture">Service architecture<a href="#service-architecture" class="hash-link" aria-label="Direct link to Service architecture" title="Direct link to Service architecture">​</a></h2><p>This section gives you an overview of external and internal architectural diagrams.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="external-architecture">External architecture<a href="#external-architecture" class="hash-link" aria-label="Direct link to External architecture" title="Direct link to External architecture">​</a></h3><p>The external architectural diagram shows how the Token metadata API is connected to three different systems, Stacks node, Stacks blockchain API database, and Postgres database.</p><p><img loading="lazy" alt="Architecture" src="/doc/assets/images/architecture-7ff8fc1b0b53b7c890cb6f0917c7e7ae.png" width="1436" height="828" class="img_ev3q"></p><ol><li>Token metadata API interacts with Stacks Blockchain API database( referred to as Local Metadata DB in the diagram) to import all historical smart contracts when booting up and to listen for new contracts that may be deployed. Read-only access is recommended as this service will never need to write anything to this database(DB).</li><li>A Stacks node to respond to all read-only contract calls required when fetching token metadata (calls to get token count, token metadata URIs, etc.).</li><li>A local Postgres DB to store all processed metadata info.</li></ol><p>The service needs to fetch external metadata files (JSONs, images) from the internet, so it must have access to external networks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal-architecture">Internal architecture<a href="#internal-architecture" class="hash-link" aria-label="Direct link to Internal architecture" title="Direct link to Internal architecture">​</a></h3><p>The following is the internal architectural diagram of the Token metadata API.</p><p><img loading="lazy" alt="Flowchart" src="/doc/assets/images/flowchart-db9986359bb25cebcdfff5321f87d719.png" width="3244" height="1428" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blockchain-importer">Blockchain importer<a href="#blockchain-importer" class="hash-link" aria-label="Direct link to Blockchain importer" title="Direct link to Blockchain importer">​</a></h4><p>The <a href="https://github.com/hirosystems/token-metadata-api/tree/master/src/token-processor/blockchain-api/blockchain-importer.ts" target="_blank" rel="noopener noreferrer"><code>BlockchainImporter</code></a> is a component in the Token metadata API that takes token contracts from the API database. This component is only used on service boot.</p><p>It connects to the Stacks Blockchain API database and scans the entire <code>smart_contracts</code> table looking for any contract that conforms to <a href="https://github.com/stacksgov/sips/blob/main/sips/sip-009/sip-009-nft-standard.md" target="_blank" rel="noopener noreferrer">SIP-009</a>, SIP-010 or SIP-013. When it finds a token contract, it creates a <a href="https://github.com/hirosystems/token-metadata-api/tree/master/src/token-processor/queue/job/process-smart-contract-job.ts" target="_blank" rel="noopener noreferrer"><code>ProcessSmartContractJob</code></a> and adds it to the <a href="#job-queue">Job queue</a>, ßso its tokens can be read and processed thereafter.</p><p>This process runs only once. If the Token metadata API is ever restarted, though, this component re-scans the API <code>smart_contracts</code> table from the last processed block height. So, it can pick up any newer contracts it might have missed while the service was unavailable.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="smart-contract-monitor">Smart contract monitor<a href="#smart-contract-monitor" class="hash-link" aria-label="Direct link to Smart contract monitor" title="Direct link to Smart contract monitor">​</a></h4><p>The <a href="https://github.com/hirosystems/token-metadata-api/tree/master/src/token-processor/blockchain-api/blockchain-smart-contract-monitor.ts" target="_blank" rel="noopener noreferrer"><code>BlockchainSmartContractMonitor</code></a> component constantly listens to the following Stacks Blockchain API events:</p><ul><li><p><strong>Smart contract log events</strong></p><p>  If a contract <code>print</code> event conforms to SIP-019, it finds the affected tokens and marks them for metadata refresh.</p></li><li><p><strong>Smart contract deployments</strong></p><p>  If the new contract is a token contract, it saves the new token contract and adds the contract to the job queue for token processing.</p></li></ul><p>This process is kept alive throughout the entire service lifetime.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="job-queue">Job queue<a href="#job-queue" class="hash-link" aria-label="Direct link to Job queue" title="Direct link to Job queue">​</a></h4><p>The role of the <a href="https://github.com/hirosystems/token-metadata-api/tree/master/src/token-processor/queue/job-queue.ts" target="_blank" rel="noopener noreferrer"><code>JobQueue</code></a> is to perform all the smart contract and token processing in the service.</p><p>It is a priority queue that organizes all necessary work for contract ingestion and token metadata processing. Every job this queue processes corresponds to one row in the <code>jobs</code> DB table, which marks its processing status and related objects to be worked on (smart contract or token).</p><p>This object essentially runs an infinite loop that follows these steps:</p><ol><li>Upon <code>start()</code>, it fetches a set number of job rows that are <code>&#x27;pending&#x27;</code> and loads their corresponding <code>Job</code> objects into memory for processing, marking those rows now as <code>&#x27;queued&#x27;</code>.</li><li>It executes each loaded job to completion concurrently. Depending on success or failure, the job row is marked as either <code>&#x27;done&#x27;</code> or <code>&#x27;failed&#x27;</code>.</li><li>Once all loaded jobs are done (and the queue is now empty), it goes back to step 1.</li></ol><p>There are two environment variables that can help you tune how the queue performs:</p><ul><li><code>ENV.JOB_QUEUE_SIZE_LIMIT</code>: The in-memory size of the queue, i.e., the number of pending jobs that are loaded from the database while they wait for execution (see step 1 above).</li><li><code>ENV.JOB_QUEUE_CONCURRENCY_LIMIT</code>: The number of jobs that will be run simultaneously.</li></ul><p>This queue runs continuously and can handle an unlimited number of jobs.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="process-smart-contract-job">Process smart contract job<a href="#process-smart-contract-job" class="hash-link" aria-label="Direct link to Process smart contract job" title="Direct link to Process smart contract job">​</a></h5><p>This job makes a contract call to the Stacks node to determine the total number of tokens declared by the given contract. Once determined, it creates and enqueues all of these tokens for metadata ingestion.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="process-token-job">Process token job<a href="#process-token-job" class="hash-link" aria-label="Direct link to Process token job" title="Direct link to Process token job">​</a></h5><p>This job fetches the metadata JSON object for a single token and other relevant properties depending on the token type (symbol, decimals, etc.). Once fetched, it parses and ingests this data to save it into the local database for API endpoints to return.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="features">Features<a href="#features" class="hash-link" aria-label="Direct link to Features" title="Direct link to Features">​</a></h2><ul><li>Complete
<a href="https://github.com/stacksgov/sips/blob/main/sips/sip-016/sip-016-token-metadata.md" target="_blank" rel="noopener noreferrer">SIP-016</a>
metadata ingestion for<ul><li><a href="https://github.com/stacksgov/sips/blob/main/sips/sip-009/sip-009-nft-standard.md" target="_blank" rel="noopener noreferrer">SIP-009</a>
Non-Fungible Tokens</li><li><a href="https://github.com/stacksgov/sips/blob/main/sips/sip-010/sip-010-fungible-token-standard.md" target="_blank" rel="noopener noreferrer">SIP-010</a>
Fungible Tokens</li><li><a href="https://github.com/stacksgov/sips/blob/main/sips/sip-013/sip-013-semi-fungible-token-standard.md" target="_blank" rel="noopener noreferrer">SIP-013</a>
Semi-Fungible Tokens</li></ul></li><li>Automatic metadata refreshes via <a href="https://github.com/stacksgov/sips/pull/72" target="_blank" rel="noopener noreferrer">SIP-019</a>
notifications.</li><li>Metadata localization support.</li><li>Metadata fetching via <code>http:</code>, <code>https:</code>, <code>data:</code> URIs. Also supported via customizable gateways:<ul><li>IPFS</li><li>Arweave</li></ul></li><li>Easy to use REST JSON endpoints with ETag caching.</li><li>Prometheus metrics for job queue status, contract and token counts, API performance, etc.</li><li>Image cache/CDN support.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-reference">API reference<a href="#api-reference" class="hash-link" aria-label="Direct link to API reference" title="Direct link to API reference">​</a></h2><p>See the <a href="https://capybaraio.github.io/doc/metadata/" target="_blank" rel="noopener noreferrer">Token metadata API Reference</a> for more information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick start<a href="#quick-start" class="hash-link" aria-label="Direct link to Quick start" title="Direct link to Quick start">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-requirements">System requirements<a href="#system-requirements" class="hash-link" aria-label="Direct link to System requirements" title="Direct link to System requirements">​</a></h3><p>The Token metadata API is a microservice with hard dependencies on other Stacks blockchain components. Before you start, you&#x27;ll need to have access to the following:</p><ol><li>A fully synchronized <a href="https://github.com/stacks-network/stacks-blockchain" target="_blank" rel="noopener noreferrer">Stacks node</a></li><li>A fully synchronized instance of the <a href="https://github.com/hirosystems/stacks-blockchain-api" target="_blank" rel="noopener noreferrer">Stacks Blockchain API</a> running in <code>default</code> or <code>write-only</code> mode, with its Postgres database exposed for new connections. A read-only DB replica is also acceptable.</li><li>A local writeable Postgres database for token metadata storage</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-service">Run service<a href="#run-service" class="hash-link" aria-label="Direct link to Run service" title="Direct link to Run service">​</a></h3><p>This section helps you to initiate the service by following the steps below.</p><ol><li>Clone the repository by using the following command:</li></ol><p><code>git clone https://github.com/hirosystems/token-metadata-api.git</code></p><ol><li><p>Create a <code>.env</code> file and specify the appropriate values to configure access to the Stacks API database, the Token metadata API local database, and the Stacks node RPC interface. See <a href="https://github.com/hirosystems/token-metadata-api/tree/master/src/env.ts" target="_blank" rel="noopener noreferrer"><code>env.ts</code></a> for all available configuration options.</p></li><li><p>Build the app (NodeJS v18+ is required)</p></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm run build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>Start the service</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm run start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stop-service">Stop service<a href="#stop-service" class="hash-link" aria-label="Direct link to Stop service" title="Direct link to Stop service">​</a></h3><p>When shutting down, you should always prefer to send the <code>SIGINT</code> signal instead of <code>SIGKILL</code> so the service has time to finish any pending background work and all dependencies are gracefully disconnected.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-image-cache-service">Using image cache service<a href="#using-image-cache-service" class="hash-link" aria-label="Direct link to Using image cache service" title="Direct link to Using image cache service">​</a></h3><p>The Token metadata API allows you to specify the path to a custom script that can pre-process every image URL detected by the service before it&#x27;s inserted into the DB. This will enable you to serve CDN image URLs in your metadata responses instead of raw URLs, providing key advantages such as:</p><ul><li>Improves image load speed</li><li>Increases reliability in case the original image becomes unavailable</li><li>Protects original image hosts from <a href="https://wikipedia.org/wiki/Denial-of-service_attack" target="_blank" rel="noopener noreferrer">DDoS attacks</a></li><li>Increases user privacy</li></ul><p>An example IMGIX processor script is included in <a href="https://github.com/hirosystems/token-metadata-api/blob/master/config/image-cache.js" target="_blank" rel="noopener noreferrer"><code>config/image-cache.js</code></a>.
You can customize the script path by altering the <code>METADATA_IMAGE_CACHE_PROCESSOR</code> environment variable.</p></div><div style="flex-direction:row;flex-wrap:wrap"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/CapybaraIO/doc/tree/main/docs/token-metadata-api/feature-guides/token-metadata-api.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col"></div></div></footer></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/token-metadata-api/getting-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting started</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/token-metadata-api/how-to-guides/how-to-stop-service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to stop the service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#service-architecture" class="table-of-contents__link toc-highlight">Service architecture</a><ul><li><a href="#external-architecture" class="table-of-contents__link toc-highlight">External architecture</a></li><li><a href="#internal-architecture" class="table-of-contents__link toc-highlight">Internal architecture</a></li></ul></li><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a></li><li><a href="#api-reference" class="table-of-contents__link toc-highlight">API reference</a></li><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick start</a><ul><li><a href="#system-requirements" class="table-of-contents__link toc-highlight">System requirements</a></li><li><a href="#run-service" class="table-of-contents__link toc-highlight">Run service</a></li><li><a href="#stop-service" class="table-of-contents__link toc-highlight">Stop service</a></li><li><a href="#using-image-cache-service" class="table-of-contents__link toc-highlight">Using image cache service</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/doc/img/hiro-docs-footer.svg" alt="Capybara developers" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/doc/img/hiro-docs-footer-light.svg" alt="Capybara developers" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 capybara</div></div></div></footer></div>
<script src="/doc/assets/js/runtime~main.63eaacc7.js"></script>
<script src="/doc/assets/js/main.873bcaee.js"></script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-59XXGSG" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --></body>
</html>